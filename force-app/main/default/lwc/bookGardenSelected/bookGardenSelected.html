<template>
    <lightning-card title="Book Details">
        <template if:true={book}>
            <div slot="actions">
                <lightning-button-icon
                    icon-name="utility:like"
                    alternative-text="Like" 
                    class="slds-m-left_xx-small" 
                    title="Like"
                    name="like"
                    label="like"
                    onclick={handleReactToBook}
                    disabled={reactionDisabled}
                ></lightning-button-icon>
                <lightning-button-icon
                    icon-name="utility:dislike"
                    alternative-text="Dislike" 
                    class="slds-m-left_xx-small" 
                    title="Dislike"
                    name="dislike"
                    label="dislike"
                    onclick={handleReactToBook}
                    disabled={reactionDisabled}
                ></lightning-button-icon>
            </div>
        </template>
        <lightning-tabset>
            <div class="book-detail-wrapper">
                <lightning-tab label={title}>
                    <div class={className}>
                        <template if:true={book}>
                            <template if:true={ableToEdit}>
                                <div class="tab-buttons-wrapper">
                                    <template if:true={book.Archived__c}>
                                        <div>
                                            <p class="archived-text">(ARCHIVED)</p>
                                        </div>
                                    </template>
                                    <div class="tab-buttons">
                                        <lightning-button-icon
                                            icon-name="utility:delete"
                                            alternative-text="Delete the Book" 
                                            class="slds-m-left_xx-small" 
                                            title="Delete the Book"
                                            name="deleteBook"
                                            label="delete the book"
                                            onclick={handleDeleteBook}
                                        ></lightning-button-icon>
                                        <lightning-button-icon
                                            icon-name="utility:archive"
                                            alternative-text="Archive the Book" 
                                            class="slds-m-left_xx-small" 
                                            title="Archive the Book"
                                            name="archiveBook"
                                            label="archive the book"
                                            onclick={handleArchiveBook}
                                        ></lightning-button-icon>
                                        <template if:false={book.Archived__c}>
                                            <lightning-button-icon
                                                icon-name="utility:edit"
                                                alternative-text="Edit the Book" 
                                                class="slds-m-left_xx-small" 
                                                title="Edit the Book"
                                                name="editBook"
                                                label="edit the book"
                                                onclick={handleEditBook}
                                            ></lightning-button-icon>
                                        </template>
                                    </div>
                                </div>
                            </template>
                            <div class="cover-review">
                                <img
                                  src={book.Image_Source__c}
                                  class="book-cover"
                                  alt="Book Cover picture"
                                />
                                <div>
                                    <div class="creator">
                                        <img
                                          src={book.CreatedBy.SmallPhotoUrl}
                                          class="creator-profile"
                                          alt="Creator Profile picture"
                                        />
                                        <div>
                                            <p class="creator-name">{book.CreatedBy.Name}</p>
                                            <p class="creator-date">{bookCreatedDate}</p>
                                        </div>
                                    </div>
                                    <p class="summary-header">Review:</p>
                                    <p class="review">"{book.Review__c}"</p>
                                </div>
                            </div>
                            <div class="genres">
                                <template for:each={book.genres} for:item="genre">
                                    <p key={genre} class="genre">{genre}</p>
                                </template>
                            </div>
                            <p class="summary-header">Summary:</p>
                            <p class="summary">{book.Summary__c}</p>
                        </template>
                        <template if:false={book}>
                            <div class="please">
                                <p class="please-select">Please select a book </p><span>ðŸ“– ðŸ¤Œ</span>
                            </div>
                        </template>
                    </div>
                </lightning-tab>
            </div>
            <template if:true={book}>
                <lightning-tab label={book.Author__r.Name}>
                    <div class="author-tab">
                        <template if:true={ableToEdit}>
                            <div class="tab-buttons">
                                <lightning-button-icon
                                    icon-name="utility:edit"
                                    alternative-text="Edit the Author" 
                                    class="slds-m-left_xx-small" 
                                    title="Edit the Author"
                                    name="editBook"
                                    label="edit the author"
                                    onclick={handleEditAuthor}
                                ></lightning-button-icon>
                            </div>
                        </template>
                        <div class="profile-info">
                            <img
                                src={author.Profile}
                                class="author-profile"
                                alt="Author Profile picture"
                            />
                            <div class="author-info">
                                <div class="from-born">
                                    <p class="author-from">{author.From}</p>
                                    <p class="author-born">{author.bornInDiedIn}</p>
                                </div>
                                <p class="author-life-header">Life:</p>
                                <p class="author-life">{author.Life}</p>
                            </div>
                        </div>
                        <template if:true={authorBooks}>
                            <div class="author-books-wrapper">
                                <h2 class="author-books-header">Books of {book.Author__r.Name}</h2>
                                <div class="author-books">
                                    <template for:each={authorBooks} for:item="book">
                                        <div class="author-book" key={book.Id}>
                                            <img
                                                src={book.Image_Source__c}
                                                class="author-book-cover"
                                                alt="Book Cover picture"
                                            />
                                            <p class="author-book-name">{book.Name}</p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </lightning-tab>
                <lightning-tab label="Comments">
                    <div class="comments-wrapper">
                        <template if:true={renderComments}>
                            <div class="comments">
                                <template for:each={book.Comments__r} for:item="comment">
                                    <div key={comment.Name} class="comment">
                                        <div class="commenter">
                                            <img
                                            src={comment.CreatedBy.SmallPhotoUrl}
                                            class="commenter-profile"
                                            alt="Comment Profile photo"
                                            />
                                            <div>
                                                <p class="commenter-name">{comment.CreatedBy.Name}</p>
                                                <p class="comment-date">{comment.commentCreatedDate}</p>
                                            </div>
                                        </div>
                                        <p class="comment-text">{comment.Comment__c}</p>
                                    </div>
                                </template>
                            </div>
                        </template>
                        <div class="comment-input">
                            <div class="textarea-wrapper">
                                <lightning-textarea 
                                    name="comment" 
                                    value={comment} 
                                    placeholder={textareaPlaceholder}
                                    label="Comment on this book." 
                                    maxlength="255" message-when-too-long="A maximum of 255 characters are allowed." 
                                    message-when-value-missing="An empty comment cannot be posted."
                                    onchange={handleCommentChange}
                                    disabled={book.Archived__c}>
                                </lightning-textarea>
                            </div>
                            <lightning-button 
                                variant="brand" 
                                label="Comment" 
                                title="Comment" 
                                onclick={handleComment} 
                                class="slds-var-m-left_x-small"
                                disabled={commentDisabled}>
                            </lightning-button>
                        </div>
                    </div>
                </lightning-tab>
            </template>
          </lightning-tabset>
    </lightning-card>
</template>